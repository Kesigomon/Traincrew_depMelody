# UI設計書

## 1. 概要

### 1.1 目的
本書は、Traincrew発車メロディー連動システムのユーザーインターフェース設計を詳細に定義する。

### 1.2 参照ドキュメント
- 要件定義書.md
- 01_システムアーキテクチャ設計書.md
- 03_インターフェース設計書.md

### 1.3 UI設計方針

| 項目 | 方針 |
|-----|------|
| デザイン | シンプルで直感的な操作性を重視 |
| カラー | システムデフォルト、必要に応じて視認性の高い色を使用 |
| フォント | システムデフォルトフォント（メイリオ等） |
| レスポンシブ | 固定サイズウィンドウ（350x700px） |
| アクセシビリティ | 大きなボタン、明確な状態表示 |

## 2. メインウィンドウ

### 2.1 ウィンドウ仕様

| 項目 | 仕様                                           |
|-----|----------------------------------------------|
| ウィンドウタイトル | "Traincrew depMelody"                        |
| サイズ | 幅: 350px, 高さ: 700px                          |
| リサイズ可能 | 可能                                           |
| 最小化 | 可能                                           |
| 最大化 | 不可                                           |
| 最前面表示 | 将来的にユーザー設定可能（初期値: false）                     |
| 背景色 | システムデフォルト                                    |
| 起動位置 | 画面中央（`WindowStartupLocation="CenterScreen"`） |

### 2.2 レイアウト構成

```
┌─────────────────────────────────────┐
│  Traincrew depMelody                │ ← タイトルバー
├─────────────────────────────────────┤
│                                     │
│                                     │
│                                     │
│                ON                   │ ← ONボタン
│                                     │   (画面上半分全体)
│                                     │   FontSize: 72pt
│                                     │   背景: 黒、前景: 白
│                                     │
├─────────────────────────────────────┤
│                                     │
│                                     │
│                                     │
│               OFF                   │ ← OFFボタン
│                                     │   (画面下半分全体)
│                                     │   FontSize: 72pt
│                                     │   背景: 赤、前景: 白
│                                     │
└─────────────────────────────────────┘

※ 開発者モード表示エリアは将来機能として追加予定
```

### 2.3 XAML構成イメージ

```xml
<Window x:Class="Traincrew_depMelody.Presentation.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Traincrew depMelody"
        Width="350" Height="700"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
     <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Button Grid.Row="0" Name="ON" Content="ON" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Black" Foreground="White" FontSize="72" Click="ButtonPressed" IsEnabled="False"/>
        <Button Grid.Row="1" Name="OFF" Content="OFF" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Red" Foreground="White"  FontSize="72" Click="ButtonPressed" IsEnabled="False"/>
    </Grid>
</Window>
```

## 3. UI要素詳細

### 3.1 ONボタン

#### 3.1.1 基本仕様

| 項目 | 仕様 |
|-----|------|
| コントロール名 | `ON` |
| 表示テキスト | "ON" |
| サイズ | ウィンドウ上半分全体（Stretch） |
| フォントサイズ | 72pt |
| 背景色（有効時） | 黒（Black） |
| 前景色 | 白（White） |
| 配置 | Grid.Row="0"、全体に引き伸ばし |

#### 3.1.2 状態別の表示

| 状態 | 有効/無効 | 背景色 | 前景色 | ツールチップ |
|-----|---------|--------|--------|-------------|
| 駅内・停止中（メロディー停止中） | 有効 | 黒（Black） | 白（White） | "メロディーを開始" |
| メロディー再生中 | 無効 | グレー | ダークグレー | "既に再生中です" |
| 自動モードON | 無効 | グレー | ダークグレー | "自動モード有効中" |

#### 3.1.3 イベント

| イベント | ハンドラ | 処理内容 |
|---------|---------|---------|
| Click | `ButtonPressed` | ONボタン押下時の処理（`MelodyControlService.StartMelodyAsync()` を呼び出し） |

### 3.2 OFFボタン

#### 3.2.1 基本仕様

| 項目 | 仕様 |
|-----|------|
| コントロール名 | `OFF` |
| 表示テキスト | "OFF" |
| サイズ | ウィンドウ下半分全体（Stretch） |
| フォントサイズ | 72pt |
| 背景色（有効時） | 赤（Red） |
| 前景色 | 白（White） |
| 配置 | Grid.Row="1"、全体に引き伸ばし |

#### 3.2.2 状態別の表示

| 状態 | 有効/無効 | 背景色 | 前景色 | ツールチップ |
|-----|---------|--------|--------|-------------|
| 駅内・停止中（メロディー再生中） | 有効 | 赤（Red） | 白（White） | "メロディーを停止" |
| メロディー停止中 | 無効 | グレー | ダークグレー | "メロディーは再生されていません" |
| 自動モードON | 無効 | グレー | ダークグレー | "自動モード有効中" |

#### 3.2.3 イベント

| イベント | ハンドラ | 処理内容 |
|---------|---------|---------|
| Click | `ButtonPressed` | OFFボタン押下時の処理（`MelodyControlService.StopMelodyAsync()` を呼び出し） |

### 3.3 開発者モードパネル（将来機能）

#### 3.3.1 基本仕様

| 項目 | 仕様 |
|-----|------|
| コントロール名 | `DeveloperPanel` |
| 初期表示 | 非表示（`Visibility="Collapsed"`） |
| 表示条件 | `AppConfiguration.DeveloperMode = true` |
| ボーダー | 1px グレー |
| パディング | 10px |
| マージン | 上部20px |

#### 3.3.2 表示項目

| 項目 | コントロール名 | 表示内容 | 更新タイミング |
|-----|---------------|---------|---------------|
| 駅名 | `StationNameText` | "駅名: 館浜駅" | メロディー状態変化時 |
| 番線 | `TrackNumberText` | "番線: 1番線" | メロディー状態変化時 |
| 状態 | `MelodyStateText` | "状態: 再生中" | メロディー状態変化時 |
| 自動モード | `AutoModeText` | "自動: ON" | 自動モード状態変化時 |
| 軌道回路 | `CircuitIdText` | "軌道回路: TC_001" | ゲーム状態変化時 |

## 4. ボタン状態遷移

### 4.1 状態遷移図

```
初期状態（駅外）
  ├─ ONボタン: 無効
  └─ OFFボタン: 無効
           ↓
      （駅に在線）
           ↓
駅内・停止中
  ├─ ONボタン: 有効
  └─ OFFボタン: 無効
           ↓
      （ONクリック）
           ↓
メロディー再生中
  ├─ ONボタン: 無効
  └─ OFFボタン: 有効
           ↓
      （OFFクリック）
           ↓
駅内・停止中（再度）
  ├─ ONボタン: 有効
  └─ OFFボタン: 無効
           ↓
      （駅から離脱）
           ↓
初期状態（駅外）
```

### 4.2 状態遷移表

| 現在の状態 | イベント | 次の状態 | ONボタン | OFFボタン |
|-----------|---------|---------|---------|----------|
| 駅外 | 駅に在線 | 駅内・停止中 | 有効 | 無効 |
| 駅内・停止中 | ONクリック | メロディー再生中 | 無効 | 有効 |
| メロディー再生中 | OFFクリック | 駅内・停止中 | 有効 | 無効 |
| メロディー再生中 | 駅から離脱 | 駅外 | 無効 | 無効 |
| 駅内・停止中 | 駅から離脱 | 駅外 | 無効 | 無効 |
| 任意の状態 | 一時停止 | 一時停止中 | 無効 | 無効 |
| 一時停止中 | 一時停止解除 | 元の状態 | 元の状態に応じる | 元の状態に応じる |
| 任意の状態 | 自動モードON | 自動モード中 | 無効 | 無効 |
| 自動モード中 | 自動モードOFF | 元の状態 | 元の状態に応じる | 元の状態に応じる |

## 5. エラー表示

### 5.1 MessageBox表示

#### 5.1.1 エラーメッセージ

| エラー種別 | タイトル | メッセージ | アイコン | ボタン |
|-----------|---------|-----------|---------|--------|
| 音声ファイル未存在 | "エラー" | "メロディーファイルが見つかりません" | Error | OK |
| 一般エラー | "エラー" | "エラー: {例外メッセージ}" | Error | OK |

#### 5.1.2 表示例

```csharp
MessageBox.Show(
    "メロディーファイルが見つかりません",
    "エラー",
    MessageBoxButton.OK,
    MessageBoxImage.Error);
```

### 5.2 ステータスバー（将来機能）

ウィンドウ下部にステータスバーを追加し、簡易的な状態表示を行う。

| 状態 | 表示テキスト |
|-----|------------|
| 正常 | "準備完了" |
| メロディー再生中 | "再生中: 館浜駅 1番線" |
| エラー | "エラー: 音声ファイルが見つかりません" |

## 6. スタイル定義

### 6.1 カラーパレット

| 要素 | カラー | 用途 |
|-----|--------|------|
| ONボタン背景（有効時） | #000000（Black / 黒） | ONボタン背景 |
| OFFボタン背景（有効時） | #FF0000（Red / 赤） | OFFボタン背景 |
| 無効状態背景 | #CCCCCC（グレー） | 無効ボタン背景 |
| ボタンテキスト（有効時） | #FFFFFF（White / 白） | 有効ボタンテキスト |
| 無効テキスト | #666666（ダークグレー） | 無効ボタンテキスト |
| ボーダー | #999999（グレー） | 開発者パネルボーダー（将来） |

### 6.2 WPFスタイル定義

現在の実装では、各ボタンに直接属性を設定している（インラインスタイル）。

**ONボタン**:
- Background: Black
- Foreground: White
- FontSize: 72

**OFFボタン**:
- Background: Red
- Foreground: White
- FontSize: 72

**無効状態の制御（将来的にトリガーで実装）**:
```xml
<Window.Resources>
    <!-- ONボタンスタイル -->
    <Style x:Key="OnButtonStyle" TargetType="Button">
        <Setter Property="Background" Value="Black"/>
        <Setter Property="Foreground" Value="White"/>
        <Setter Property="FontSize" Value="72"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Style.Triggers>
            <Trigger Property="IsEnabled" Value="False">
                <Setter Property="Background" Value="#CCCCCC"/>
                <Setter Property="Foreground" Value="#666666"/>
            </Trigger>
        </Style.Triggers>
    </Style>

    <!-- OFFボタンスタイル -->
    <Style x:Key="OffButtonStyle" TargetType="Button">
        <Setter Property="Background" Value="Red"/>
        <Setter Property="Foreground" Value="White"/>
        <Setter Property="FontSize" Value="72"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Style.Triggers>
            <Trigger Property="IsEnabled" Value="False">
                <Setter Property="Background" Value="#CCCCCC"/>
                <Setter Property="Foreground" Value="#666666"/>
            </Trigger>
        </Style.Triggers>
    </Style>
</Window.Resources>
```

## 7. アニメーション（将来機能）

### 7.1 ボタンクリックアニメーション

ボタンクリック時に軽微なスケールアニメーションを適用。

```xml
<Button.Triggers>
    <EventTrigger RoutedEvent="Button.Click">
        <BeginStoryboard>
            <Storyboard>
                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX"
                                 From="1.0" To="0.95" Duration="0:0:0.1" AutoReverse="True"/>
                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY"
                                 From="1.0" To="0.95" Duration="0:0:0.1" AutoReverse="True"/>
            </Storyboard>
        </BeginStoryboard>
    </EventTrigger>
</Button.Triggers>
```

### 7.2 状態遷移アニメーション

ボタンの有効/無効状態が変化する際のフェードアニメーション。

## 8. アクセシビリティ

### 8.1 キーボードナビゲーション

#### 8.1.1 キーボード操作による制御（将来機能）

キーボードを使ってメロディーのON/OFF操作を行う機能。

**実装方針**:
- MainWindowでKeyDownイベントをハンドリングし、特定のキーが押されたときにメロディー制御を実行
- 将来的には設定ファイルでキーバインドをカスタマイズ可能にすることも検討

**基本動作**:
- キー入力時、対応するボタンが有効な場合のみ動作を実行
  - 例: メロディー停止中にONキーを押すと、ONボタンをクリックした場合と同じ動作
  - 例: メロディー再生中にOFFキーを押すと、OFFボタンをクリックした場合と同じ動作
- ボタンが無効な場合（駅外、自動モード中など）はキー入力を無視

**実装イメージ**:
```csharp
private void Window_KeyDown(object sender, KeyEventArgs e)
{
    // メロディーONキー
    if (e.Key == Key.D1 || e.Key == Key.NumPad1)
    {
        if (OnButton.IsEnabled)
        {
            OnButton_Click(sender, e);
        }
    }
    // メロディーOFFキー
    else if (e.Key == Key.D2 || e.Key.NumPad2)
    {
        if (OffButton.IsEnabled)
        {
            OffButton_Click(sender, e);
        }
    }
}
```

#### 8.1.2 WPF標準のキーボードナビゲーション

| キー | 動作 |
|-----|------|
| Tab | 次のコントロールにフォーカス移動 |
| Shift+Tab | 前のコントロールにフォーカス移動 |
| Enter / Space | フォーカス中のボタンをクリック |
| Alt+F4 | ウィンドウを閉じる |

### 8.2 ツールチップ

各ボタンに状態に応じたツールチップを表示し、操作ガイダンスを提供。

### 8.3 スクリーンリーダー対応

`AutomationProperties` を設定し、スクリーンリーダーに適切な情報を提供。

```xml
<Button Name="ON"
        AutomationProperties.Name="メロディー開始ボタン"
        AutomationProperties.HelpText="発車メロディーの再生を開始します"/>
```

## 9. 将来のUI拡張

### 9.1 設定ウィンドウ

メニューバーに「設定」メニューを追加し、設定ウィンドウを開く。

**設定項目**:
- FFmpegパス
- 音声ベースディレクトリ
- 自動モード設定
- キーボード操作設定
- 開発者モード有効化

### 9.2 メニューバー

ウィンドウ上部にメニューバーを追加。

| メニュー | サブメニュー | 動作 |
|---------|------------|------|
| ファイル | 終了 | アプリケーション終了 |
| 設定 | 設定を開く | 設定ウィンドウ表示 |
| ヘルプ | バージョン情報 | バージョン情報ダイアログ表示 |

### 9.3 通知エリア（トレイアイコン）

タスクトレイにアイコンを表示し、最小化時にトレイに格納。

| 機能 | 動作 |
|-----|------|
| トレイアイコン右クリック | コンテキストメニュー表示 |
| コンテキストメニュー | 「開く」「終了」 |
| アイコンダブルクリック | ウィンドウを復元 |

## 10. まとめ

本UI設計書では、以下を定義した：

1. **メインウィンドウ**: 極めてシンプルな2ボタンフルスクリーンレイアウト
   - ONボタン: 画面上半分全体、黒背景・白文字、フォントサイズ72pt
   - OFFボタン: 画面下半分全体、赤背景・白文字、フォントサイズ72pt
2. **ボタン仕様**: 状態に応じた有効/無効制御と視覚的フィードバック
3. **エラー表示**: MessageBoxによる明確なエラー通知
4. **スタイル定義**: 視認性を最大化したシンプルなカラーリング（黒・赤・白）
5. **アクセシビリティ**: キーボードナビゲーション・ツールチップ対応

大きなボタンと明確な色分けにより、ゲームプレイ中でも操作しやすいUIを提供する。
将来的には開発者モードや設定ウィンドウなどの拡張にも対応可能な設計となっている。
